<!DOCTYPE html>
<html lang="en" class="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Djankrom District YAF - Change password</title>

  <!-- Tailwind is included -->
  <link rel="stylesheet" href="stylesheets/main.css?v=1628755089081">

  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>

  <meta name="description" content="Djankrom District YAF - Change password">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130795909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-130795909-1');
  </script>
   <script
   src="https://code.jquery.com/jquery-3.7.0.js"
   integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
   crossorigin="anonymous"
 ></script>

</head>
<body>

<div id="app">

<nav id="navbar-main" class="navbar is-fixed-top">
  <div class="navbar-brand">
    <a class="navbar-item mobile-aside-button">
      <span class="icon"><i class="mdi mdi-forwardburger mdi-24px"></i></span>
    </a>
    <div class="navbar-item">
      <div class="control"><input placeholder="Search everywhere..." class="input"></div>
    </div>
  </div>
  <div class="navbar-brand is-right">
    <a class="navbar-item --jb-navbar-menu-toggle" data-target="navbar-menu">
      <span class="icon"><i class="mdi mdi-dots-vertical mdi-24px"></i></span>
    </a>
  </div>
  <div class="navbar-menu" id="navbar-menu">
    <div class="navbar-end">
      <div class="navbar-item dropdown has-divider has-user-avatar">
        <a class="navbar-link">
          <div class="user-avatar">
            <img src="images/profile.svg" class="rounded-full">
          </div>
          <div class="is-user-name"><span id="username"></span></div>
          <span class="icon"><i class="mdi mdi-chevron-down"></i></span>
        </a>
        <div class="navbar-dropdown">
          <a href="profile.html" class="navbar-item">
            <span class="icon"><i class="mdi mdi-account"></i></span>
            <span>Profile</span>
          </a>
          <a href="create-account.html" class="navbar-item">
            <span class="icon"><i class="mdi mdi-account-lock-outline"></i></span>
            <span>account</span>
          </a>
          <hr class="navbar-divider">
          <a class="navbar-item">
            <span class="icon"><i class="mdi mdi-logout"></i></span>
            <span id="logout">Log Out</span>
          </a>
        </div>
      </div>
      <a href="dashboard.html" class="navbar-item desktop-icon-only">
        <img src="images/yaf.jpeg" alt="YAF" class="rounded-full">
      </a>
    </div>
  </div>
</nav>

<aside class="aside is-placed-left is-expanded">
  <div class="aside-tools">
    <div>
      District <b class="font-black">YAF</b>
    </div>
  </div>
  <div class="menu is-menu-main">
    <p class="menu-label">Overview</p>
    <ul class="menu-list">
      <li class="active">
        <a href="dashboard.html">
          <span class="icon"><i class="mdi mdi-desktop-mac"></i></span>
          <span class="menu-item-label">Dashboard</span>
        </a>
      </li>
    </ul>
    <p class="menu-label">Info</p>
    <ul class="menu-list">
      <li class="--set-active-profile-html">
        <a href="profile.html">
          <span class="icon"><i class="mdi mdi-account-circle"></i></span>
          <span class="menu-item-label">Profile</span>
        </a>
      </li>
      <li class="--set-active-forms-html">
        <a href="entry.html">
          <span class="icon"><i class="mdi mdi-square-edit-outline"></i></span>
          <span class="menu-item-label">Add</span>
        </a>
      </li>
      <li id="account">
        <a href="create-account.html">
          <span class="icon"><i class="mdi mdi-account-lock-outline"></i></span>
          <span class="menu-item-label">Create account</span>
        </a>
      </li>
      <li>
        <a href="change-password.html">
          <span class="icon"><i class="mdi mdi-lock"></i></span>
          <span class="menu-item-label">Change password</span>
        </a>
      </li>
    </ul>
  </div>
</aside>

<section class="is-title-bar">
  <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0">
    <ul>
      <li>Admin</li>
      <li>Change password</li>
    </ul>
  </div>
</section>

  <section class="section main-section">
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-1 mb-12">
        <div class="card">
          <header class="card-header">
            <p class="card-header-title">
              <span class="icon"><i class="mdi mdi-lock"></i></span>
              Change Password
            </p>
          </header>
          <div class="card-content">
            <form>
              <div class="field">
                <label class="label">Current password</label>
                <div class="control icons-right">
                  <input type="password" name="current-password" autocomplete="current-password" class="input">
                </div>
                <p style="color: red;display: none;" class="help" id="current-error">Required. Your current password</p>
              </div>
              <hr>
              <div class="field">
                <label class="label">New password</label>
                <div class="control">
                  <input type="password" autocomplete="new-password" name="new-password" class="input">
                </div>
                <p style="color: red;display: none;" class="help" id="new-error">Required. New password</p>
              </div>
              <div class="field">
                <label class="label">Confirm password</label>
                <div class="control">
                  <input type="password" autocomplete="new-password" name="confirm-password" class="input">
                </div>
                <p style="color: red;display: none;" class="help" id="confirm-error">Required. New password one more time</p>
              </div>
              <p style="display: none; padding: 2% 0 0 25%;" id="statusMessage"></p>
              <hr>
              <div class="field">
                <div class="control">
                  <button type="submit" class="button green">
                    Update
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

  </section>

<footer class="footer">
  <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0">
    <div class="flex items-center justify-start space-x-3">
      <div>
        Â© 2023, Djankrom District YAF
      </div>
    </div>

  </div>
</footer>

</div>

<script>
  /* Window loading */
  $(window).on('load', () => {
    /* Get user data */
    const user = JSON.parse(localStorage.getItem('user'));
    $('#username').text(user.firstname);
    $('img').attr('alt', user.firstname);

     /* Check user role and hide create account */
     if (user.role !== 'admin')
        $('#account').hide();

  });


  /* Document ready */
  $(document).ready(function() {

    /* Form submission */
    $('form').submit((event) => {
      event.preventDefault();

      const user = JSON.parse(localStorage.getItem('user'));
      const currentPassword = $('input[name="current-password"]').val();
      const newPassword = $('input[name="new-password"]').val();
      const confirmPassword = $('input[name="confirm-password"]').val();

      if (!currentPassword) {
        $('#current-error').show();
        return;
      } else {
        $('#current-error').hide();
      }

      if (!newPassword) {
        $('#new-error').show();
        return;
      } else {
        $('#new-error').hide();
      }

      if (!confirmPassword) {
        $('#confirm-error').show();
        return;
      } else {
        $('#confirm-error').hide();
      }

      if (newPassword !== confirmPassword) {
        $('#statusMessage').css('color', 'red');
        $('#statusMessage').show();
        $('#statusMessage').text('Passwords do not match');
        return;
      }

      const data = {
        current_password: currentPassword,
        new_password: newPassword,
      };

      $.ajax({
          type: 'PUT',
          url: `/api/v1/users/${user.id}/edit`,
          data,
          dataType: 'json',
          headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },
          success: (response) => {
            
            const { status, message } = response;

            if (status === 'success') {
              $('#statusMessage').css('color', 'green');
              $('#statusMessage').show();
              $('#statusMessage').text(message);
              $('input[name="current-password"]').val('');
              $('input[name="new-password"]').val('');
              $('input[name="confirm-password"]').val('');
            } else {
              $('#statusMessage').css('color', 'red');
              $('#statusMessage').show();
              $('#statusMessage').text(message);
            }
          },
      });


    }); // Form submission

    /* Handling logout */
    $('#logout').click((event) => {
      event.preventDefault();
      localStorage.removeItem('user');
      localStorage.removeItem('token');
      localStorage.removeItem('district-metadata');
      localStorage.removeItem('branch-metadata');
      window.location.href = '/';
    });

  });

</script>

<!-- Scripts below are for demo only -->
<script type="text/javascript" src="javascripts/main.min.js?v=1628755089081"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '658339141622648');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=658339141622648&ev=PageView&noscript=1"/></noscript>

<!-- Icons below are for demo only. Feel free to use any icon pack. Docs: https://bulma.io/documentation/elements/icon/ -->
<link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.9.95/css/materialdesignicons.min.css">

</body>
</html>
